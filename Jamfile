# $Id: Jamfile,v 1.41 2004/03/15 17:08:37 titer Exp $
#
# This file is part of the HandBrake source code.
# Homepage: <http://handbrake.m0k.org/>.
# It may be used under the terms of the GNU General Public License.

SubDir TOP ;

HB_PACKAGES = ;
HB_LIBS     =  libhb.a liba52.a libavcodec.a libdvdplay.a libdvdread.a
               libdvdcss.a libfaac.a libmp3lame.a libmp4v2.a libmpeg2.a
	       libvorbis.a libvorbisenc.a libogg.a libx264.a
	       libxvidcore.a ;

# CLI app
ObjectCcFlags test/test.c : -I$(TOP)/core -g -Wall ;
LinkLibraries HBTest : $(HB_LIBS) ;
Main HBTest : test/test.c ;

# BeOS
if $(OS) = BEOS
{
    SOURCES_BEOS = beos/HBApp.cpp beos/HBWindow.cpp ;
    ObjectC++Flags $(SOURCES_BEOS) :
        -I$(TOP)/core -I$(TOP)/beos/liblayout -g -Wall ;
    LINKLIBS on HandBrake = $(LINKLIBS) -L$(TOP)/lib -llayout -lbe ;
    LinkLibraries HandBrake : $(HB_LIBS) ;
#    Main HandBrake : $(SOURCES_BEOS) ;
}

# OS X
if $(OS) = MACOSX
{
    # Build the app
    OSXApp HandBrake.app ;
    Depends HandBrake.app : $(HB_LIBS) macosx/Controller.h
        macosx/Controller.mm macosx/PictureGLView.h
	macosx/PictureGLView.mm ;
    Depends all : HandBrake.app ;
    
    # Package
    OSXPackage HandBrake-$(HB_VERSION)-OSX.zip ;
    Depends HandBrake-$(HB_VERSION)-OSX.zip : HandBrake.app ;
    HB_PACKAGES += HandBrake-$(HB_VERSION)-OSX.zip ;
}

# GTK2
if $(OS) = LINUX
{
    SOURCES_GTK2 = gtk2/main.c gtk2/callbacks.c gtk2/interface.c
                   gtk2/support.c ;
    ObjectCcFlags $(SOURCES_GTK2) :
        -I$(TOP)/core `pkg-config gtk+-2.0 --cflags` ;
    LINKLIBS on gtk2HB = $(LINKLIBS) `pkg-config gtk+-2.0 --libs` ;
    LinkLibraries gtk2HB : $(HB_LIBS) ;
    Main gtk2HB : $(SOURCES_GTK2) ;
}

# Packages
NotFile package ;
Depends package : $(HB_PACKAGES) ;

SubInclude TOP contrib ;
SubInclude TOP core ;

